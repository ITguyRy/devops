<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Jenkins Slaves &amp; PowerShell</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://devopslibrary.com/lessons/jenkins-slaves-powershell">
  <link rel="alternate" type="application/rss+xml" title="DevOps Library" href="http://devopslibrary.com/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">DevOps Library</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Jenkins Slaves & PowerShell</h1>
    <p class="post-meta"><time datetime="2015-10-13T13:00:00-04:00" itemprop="datePublished">Oct 13, 2015</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <div class="video"><figure><iframe width="640" height="480" src="//www.youtube.com/embed/AN_uc9YqEC4" frameborder="0" allowfullscreen=""></iframe></figure></div>

<p>Today we’re going to talk about Jenkins slaves, and PowerShell jobs. We’ll be starting out with two servers, a Jenkins master, and a fresh Server 2012 R2 VM with the latest Java JDK and .NET 3.5 installed. If you’d like to get started quickly, download our Vagrant File or watch the previous Jenkins episode if you want help getting started.</p>

<p>VagrantFile:
http://devopslibrary.com/episode5-jenkins.zip</p>

<p>Transcript:</p>

<p>Welcome to the Devops Library, this is episode 5.  Special shout out to Phil Porada for his suggestion of featuring a Jenkins tutorial, so today we’re going to talk about Jenkins slaves, and PowerShell jobs.  We’ll be starting out with two servers, a Jenkins master, and a fresh Server 2012 R2 VM with the latest Java JDK and .NET 3.5 installed.  If you’d like to get started quickly, download our Vagrant File or watch the previous Jenkins episode which should help you.</p>

<p>Alright let’s go. We find ourselves at a fresh Jenkins install, ready to create a job.  But this time, we want to run Powershell not Bash.  As our Jenkins master was installed on a Linux server, we can’t run Powershell directly from it, but we can run it on a Windows Jenkins Slave.  Keep in mind you can always install the Jenkins master on Windows, but we recommend using Linux unless you’re exclusively a Windows shop.  Now what is a Jenkins slave you ask?  A slave is just a server that you’ve set up within Jenkins that you can run your jobs from.  For performance, it’s actually better to never run the jobs themselves directly on the master, and to always use slaves.</p>

<p>Today, we’re going to start by setting up our first slave, a Windows server.  Start by clicking “manage Jenkins”, then head to “Manage Nodes”.  Here you should see a single node named “master”.  That’s our Jenkins master that’s also running the WebUI.  Let’s click “New Node”.  Select Dumb Slave, and give the slave a name, we’ll just name ours winslave01.  Click ok.</p>

<p>Go ahead and fill in a description if you’d like, now look at the number of executors.  The number of executors determines how many jobs can be ran simultaneously on this slave, so if you have 2 executors, and 5 jobs scheduled, 3 of them will be held until the first two finish.  If you haven’t gathered much performance data, a pretty safe method is to set this number to the amount of cores the slave server has.  Now for the remote directory, we’re going to type C:\jenkins.  Let’s go ahead and quickly RDP into our Windows server and create that folder.  If you don’t create the folder, Jenkins will fail to install on the slave.</p>

<p>Alright, now back to Jenkins.  On the line that says Labels, just type windows.  Labels are used when setting up jobs, they allow you to specify which slaves the job will be run on.  Now change the Launch method to “Launch slave agents via Java WebStart”.  If we were setting up a Linux slave, it’s easiest to launch via SSH, but trust us when we say to use webstart for Windows slaves.</p>

<p>Now hit save.  Jenkins should return you to the nodes page, and you’ll see that our windows slave has an X on it because it’s not connected, go ahead and click that now.  Right click the Launch button, and copy the shortcut.  Now switch to our Windows server and visit that URL.  Run the application, and you should see a little Jenkins butler window show up. At this point, the slave is live, but let’s do one more thing.  At the top left of the window, hit the File dropdown and click install as Windows Service.  That’s all you have to do, now we have a Windows slave.</p>

<p>Head back to the Jenkins homepage.  On the left hand side of the screen you should now see “master” and winslave01 under the build executors.  We have one last thing that we need to do to be able to run Powershell commands.  By default, when creating a job, Jenkins will only give you the option of running a shell or windows batch command.  We need to install a plugin to support Powershell.  Go back to manage Jenkins, then hit manage plugins.  Click the available tab, and feel free to browse the huge collection available.  We’re going to select the “Powershell Plugin”.  Check it, and hit Download now and install after restart.  Now check the box that says restart Jenkins when installation completes.  Jenkins will now wait until all jobs have finished running, install the plugin, and quickly restart.</p>

<p>Now that we have the plugin, let’s create our first Powershell job.  Click new item, name the job, select freestyle project and hit ok.  First, let’s make sure that this job will only run on our Windows slaves.  Check the box that says “restrict where this project can run”, and type in the label we created earlier, “windows”.  Under Build, add a build step for Windows Powershell.  Type a powershell command, we’ll use “Get-Help”, then save the job.</p>

<p>Now let’s run it.  Click build now, then go to the console output.  You should now see the output of your first Powershell job!  Congrats!  There is so much more that you can do with Jenkins, and remember you can always add more slaves, or design the jobs to run commands on remote servers using ssh or WinRM.  As always, please let us know what you’d like to see more of in the comments.</p>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">DevOps Library</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>DevOps Library</li>
          <li><a href="mailto:admin@devopslibrary.com">admin@devopslibrary.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/kenerwin88"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">kenerwin88</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/devopslibrary"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">devopslibrary</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Welcome to the DevOps Library!  We have the best videos for the best admins!
</p>
      </div>
    </div>

  </div>

</footer>
<!-- Piwik -->
<script type="text/javascript">
    var _paq = _paq || [];
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
    var u="//kendog15.piwikpro.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
    </script>
<noscript><p><img src="//kendog15.piwikpro.com/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->


  </body>

</html>
